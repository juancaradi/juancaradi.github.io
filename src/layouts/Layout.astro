---
import { ClientRouter } from 'astro:transitions';

const { title = "Camilo Ram√≠rez", lang = "es" } = Astro.props;

// Base path por idioma
const base = lang === "en" ? "/en" : "/es";

// Switch de idioma conservando ruta cuando sea posible
const path = Astro.url.pathname;
const swapped =
	path.startsWith("/es/") ? path.replace("/es/", "/en/") :
	path.startsWith("/en/") ? path.replace("/en/", "/es/") :
	(lang === "en" ? "/es/" : "/en/");

// --- 3. L√≥gica para DETECTAR SECCI√ìN ACTIVA ---
const currentPath = Astro.url.pathname;
const isActive = (href) => {
	// Normalizamos quitando slash final para comparar f√°cil
	const normalize = (p) => p.replace(/\/$/, "");
	const h = normalize(href);
	const c = normalize(currentPath);
	
	// Si es el home, debe ser exacta. Si no, basta con que empiece por ah√≠.
	if (h === normalize(base)) return c === h;
	return c.startsWith(h);
};

// Textos (biling√ºe)
const t = {
	name: "Juan Camilo Ram√≠rez D√≠az",
	navLabel: lang === "en" ? "Primary navigation" : "Navegaci√≥n principal",
	projects: lang === "en" ? "Projects" : "Proyectos",
	notes: lang === "en" ? "Notes" : "Notas",
	about: lang === "en" ? "About" : "Acerca",
	freelance: "Freelance",
	switchTo: lang === "en" ? "Switch to Spanish" : "Cambiar a ingl√©s",
	toggleTheme: lang === "en" ? "Toggle theme" : "Cambiar tema",
	footer: lang === "en" ? "Built with Astro + GitHub Pages" : "Hecho con Astro + GitHub Pages",
	desc: lang === "en"
		? "Projects, freelance work, and math course notes."
		: "Proyectos, trabajo freelance y notas de matem√°ticas.",
	bio: lang === "en"
		? "Undergraduate mathematics student, recently focused on data analysis (TDA) and graph theory. I also practice taekwondo."
		: "Estudiante de pregrado en Matem√°ticas, recientemente enfocado en an√°lisis de datos (TDA) y teor√≠a de grafos. Tambi√©n practico taekwondo.",
	location: "Medell√≠n, Colombia",
	githubUrl: "https://github.com/",
	linkedinUrl: "https://www.linkedin.com/",
	email: "juancaradi@gmail.com",
};
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={t.desc} />

		<ClientRouter />

		<script is:inline>
			const root = document.documentElement;
			const saved = localStorage.getItem("theme");
			const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
			if (saved === "dark" || (!saved && prefersDark)) {
				root.setAttribute("data-theme", "dark");
			} else {
				root.setAttribute("data-theme", "light");
			}
		</script>
	</head>

	<body>
		<header class="topbar">
			<div class="topbar-inner">
				<div class="topbar-left">
					<a class="site-title" href={`${base}/`} aria-label={lang === "en" ? "Home" : "Inicio"}>
						<span class="title-pill" aria-hidden="true">
							<span class="title-first">CAMILO</span>
							<span class="title-last">RAM√çREZ</span>
						</span>
						<span class="sr-only">Camilo Ram√≠rez</span>
					</a>
				</div>

				<nav class="topnav" aria-label={t.navLabel}>
					<a href={`${base}/projects/`} class={isActive(`${base}/projects/`) ? "active" : ""}>
						{t.projects}
					</a>
					<a href={`${base}/freelance/`} class={isActive(`${base}/freelance/`) ? "active" : ""}>
						{t.freelance}
					</a>
					<a href={`${base}/notes/`} class={isActive(`${base}/notes/`) ? "active" : ""}>
						{t.notes}
					</a>
					<a href={`${base}/about/`} class={isActive(`${base}/about/`) ? "active" : ""}>
						{t.about}
					</a>
				</nav>

				<div class="top-actions">
					<a class="pill" href={swapped} aria-label={t.switchTo}>
						{lang === "en" ? "ES" : "EN"}
					</a>

					<button
						id="theme-toggle"
						class="pill"
						type="button"
						aria-label={t.toggleTheme}
						title={t.toggleTheme}
					>
						<span class="icon sun" aria-hidden="true">‚òÄÔ∏è</span>
						<span class="icon moon" aria-hidden="true">üåô</span>
					</button>
				</div>
			</div>
		</header>

		<div class="shell">
			<aside class="sidebar" aria-label={lang === "en" ? "Profile card" : "Tarjeta de perfil"}>
				<a class="avatar" href={`${base}/`} aria-label={lang === "en" ? "Home" : "Inicio"}>
					<img
						src="/img/avatar.jpg"
						alt={lang === "en" ? "Portrait photo" : "Foto de perfil"}
						width="240"
						height="240"
						loading="eager"
						fetchpriority="high"
					/>
				</a>

				<div class="identity">
					<div class="name">{t.name}</div>
					<p class="bio muted">{t.bio}</p>

					<div class="meta muted">
						<span class="meta-item" title={lang === "en" ? "Location" : "Ubicaci√≥n"}>
							<span class="meta-ico location-icon" aria-hidden="true">
								<svg class="ico" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="35" height="35">
									<path fill="currentColor" d="M100.232 149.198c-2.8 0-5.4-1.8-7.2-5.2-22.2-41-22.4-41.4-22.4-41.6-3.2-5.1-4.9-11.3-4.9-17.6 0-19.1 15.5-34.6 34.6-34.6s34.6 15.5 34.6 34.6c0 6.5-1.8 12.8-5.2 18.2 0 0-1.2 2.4-22.2 41-1.9 3.4-4.4 5.2-7.3 5.2zm.1-95c-16.9 0-30.6 13.7-30.6 30.6 0 5.6 1.5 11.1 4.5 15.9.6 1.3 16.4 30.4 22.4 41.5 2.1 3.9 5.2 3.9 7.4 0 7.5-13.8 21.7-40.1 22.2-41 3.1-5 4.7-10.6 4.7-16.3-.1-17-13.8-30.7-30.6-30.7z"/>
									<path fill="currentColor" d="M100.332 105.598c-10.6 0-19.1-8.6-19.1-19.1s8.5-19.2 19.1-19.2c10.6 0 19.1 8.6 19.1 19.1s-8.6 19.2-19.1 19.2zm0-34.3c-8.3 0-15.1 6.8-15.1 15.1s6.8 15.1 15.1 15.1 15.1-6.8 15.1-15.1-6.8-15.1-15.1-15.1z"/>
								</svg>
							</span>
							{t.location}
						</span>
					</div>

					<div class="social" aria-label={lang === "en" ? "Links" : "Enlaces"}>
						<a class="social-btn github" href={t.githubUrl} target="_blank" rel="noreferrer" aria-label="GitHub">
							<svg class="octicon" viewBox="0 0 16 16" width="18" height="18" aria-hidden="true">
								<path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52 -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07 -1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75 -3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38 A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8Z"/>
							</svg>
						</a>
						
						<a class="social-btn linkedin" href={t.linkedinUrl} target="_blank" rel="noreferrer" aria-label="LinkedIn">
							<span class="li" aria-hidden="true">in</span>
						</a>
						
						<a class="social-btn" href={`mailto:${t.email}`} aria-label={lang === "en" ? "Email" : "Correo"}>
							<span aria-hidden="true">‚úâ</span>
						</a>
					</div>
				</div>

				<footer class="side-footer muted">
					¬© {new Date().getFullYear()} ¬∑ {t.footer}
				</footer>
			</aside>

			<main class="content" aria-label={lang === "en" ? "Content" : "Contenido"}>
				<slot />
			</main>
		</div>

		<script>
			const applyTheme = () => {
				const saved = localStorage.getItem("theme");
				const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
				if (saved === "dark" || (!saved && prefersDark)) {
					document.documentElement.setAttribute("data-theme", "dark");
				} else {
					document.documentElement.setAttribute("data-theme", "light");
				}
			};

			const initButton = () => {
				const btn = document.getElementById("theme-toggle");
				if (btn) {
					const newBtn = btn.cloneNode(true); 
					if(btn.parentNode) btn.parentNode.replaceChild(newBtn, btn);

					newBtn.addEventListener("click", () => {
						const root = document.documentElement;
						const current = root.getAttribute("data-theme");
						const next = current === "dark" ? "light" : "dark";
						root.setAttribute("data-theme", next);
						localStorage.setItem("theme", next);
					});
				}
			};

			document.addEventListener('astro:after-swap', applyTheme);
			document.addEventListener('astro:page-load', initButton);
			
			initButton();
		</script>
	</body>
</html>

<style>
	:root {
		/* Layout */
		--maxw: 1100px;
		--pad: 24px;

		/* Light Theme Colors */
		--bg: #ffffff;
		--text: #111111;
		--muted: rgba(127, 127, 127, 0.85);
		--border: rgba(127, 127, 127, 0.22);

		/* Links: Azul Principal */
		--link: #0969da;
		--link-hover: #0550ae;

		/* Code */
		--code-bg: rgba(127, 127, 127, 0.08);

		/* Title Badge Vars (Light) */
		--title-bg: rgba(9, 105, 218, 0.08);
		--title-border: rgba(9, 105, 218, 0.22);
		--title-glow: rgba(9, 105, 218, 0.5);

		/* ‚úÖ COLORES NUEVOS (Light) */
		--brand-linkedin: #0077b5; /* Azul oficial */
		--brand-github: #24292f;   /* Negro oficial GitHub */
		--icon-loc: #dc2626;       /* Rojo "Tomato" (UI standard location) */
	}

	/* Dark Theme Colors */
	html[data-theme="dark"] {
		--bg: #232323;
		--text: #f2f2f2;
		--muted: rgba(242, 242, 242, 0.72);
		--border: rgba(255, 255, 255, 0.18);

		/* Links */
		--link: #58a6ff;
		--link-hover: #79c0ff;

		--code-bg: rgba(255, 255, 255, 0.10);

		/* Title Badge Vars (Dark) */
		--title-bg: rgba(88, 166, 255, 0.10);
		--title-border: rgba(88, 166, 255, 0.22);
		--title-glow: rgba(88, 166, 255, 0.6);

		/* ‚úÖ COLORES NUEVOS (Dark) */
		--brand-github: #ffffff;   /* Blanco para GitHub en modo oscuro */
		--icon-loc: #f87171;       /* Rojo pastel suave */
	}

	html, body { margin: 0; padding: 0; }

	body {
		background: var(--bg);
		color: var(--text);
		font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
		line-height: 1.55;
		transition: background 0.15s ease, color 0.15s ease;
	}

	.muted { color: var(--muted); }

	/* ---------- Topbar ---------- */
	.topbar {
		position: sticky;
		top: 0; z-index: 50;
		background: var(--bg);
		border-bottom: 1px solid var(--border);
	}

	.topbar-inner {
		max-width: var(--maxw); margin: 0 auto; padding: 14px var(--pad);
		display: flex; align-items: center; justify-content: space-between; gap: 16px;
	}

	.topbar-left {
		flex: 0 0 290px; display: flex; justify-content: center;
	}

	/* Site title */
	.site-title {
		display: inline-flex; align-items: center;
		text-decoration: none; color: var(--text);
	}
	.site-title:hover { text-decoration: none; }

	.title-pill {
		display: inline-flex; align-items: baseline; gap: 0.2em;
		padding: 6px 14px;
		border-radius: 999px; border: 1px solid var(--title-border);
		background: var(--title-bg);
		box-shadow: 0 1px 0 rgba(0,0,0,0.04);
		transition: all 0.2s ease; 
	}

	.title-first, .title-last {
		font-weight: 900; letter-spacing: -0.03em; text-transform: uppercase;
		line-height: 1; font-size: 1.05rem; transition: color 0.2s ease;
	}
	.title-first { color: var(--link); }
	.title-last { color: var(--text); }

	/* Hover Title Effect */
	.site-title:hover .title-pill {
		background: var(--link); border-color: var(--link);
		transform: translateY(-2px); box-shadow: 0 6px 15px var(--title-glow);
	}
	.site-title:hover .title-first, .site-title:hover .title-last {
		color: var(--bg); 
	}

	.sr-only {
		position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
		overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
	}

	/* Navigation */
	.topnav { display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
	.topnav a.active {
		font-weight: 700; text-decoration: underline; text-underline-offset: 4px; color: var(--text);
	}

	.top-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

	/* ---------- Layout Shell ---------- */
	.shell {
		max-width: var(--maxw); margin: 0 auto; padding: var(--pad);
		display: grid; grid-template-columns: 290px 1fr; gap: 28px; align-items: start;
	}

	.sidebar {
		position: sticky; top: 72px;
		border: 1px solid var(--border); border-radius: 18px; padding: 18px;
		background: var(--bg);
		display: flex; flex-direction: column; align-items: center;
	}
	.content { min-width: 0; }

	.avatar {
		display: inline-block; width: 170px; border-radius: 999px;
		overflow: hidden; border: 1px solid var(--border);
	}
	.avatar img { display: block; width: 100%; height: auto; }

	.identity { margin-top: 14px; text-align: center; width: 100%; }
	.name { font-weight: 750; font-size: 18px; letter-spacing: -0.01em; }
	.bio { margin: 8px 0 10px; font-size: 0.95em; line-height: 1.45; }

	/* Metadata (Location) */
	.meta { display: flex; flex-direction: column; gap: 6px; margin: 10px 0 14px; align-items: center; }
	.meta-item { display: inline-flex; gap: 4px; align-items: center; font-size: 0.92em; }
	
	/* ‚úÖ CORRECCI√ìN COLOR UBICACI√ìN */
	.meta-ico { display: inline-flex; align-items: center; justify-content: center; }
	.location-icon { color: var(--icon-loc); } /* Aplica color rojo UI */
	.meta-ico .ico { display: block; }

	/* Social Buttons */
	.social { display: flex; gap: 10px; justify-content: center; margin-top: 6px; }
	.social-btn {
		width: 36px; height: 36px;
		display: inline-flex; align-items: center; justify-content: center;
		border: 1px solid var(--border); border-radius: 12px;
		background: transparent; text-decoration: none; color: var(--text);
	}
	.social-btn:hover { border-color: var(--link-hover); }
	
	/* ‚úÖ COLORES SOCIALES NATIVOS */
	.social-btn.linkedin { color: var(--brand-linkedin); }
	.social-btn.github { color: var(--brand-github); }

	.octicon { display: block; }
	.li { font-weight: 800; font-size: 14px; }

	/* Toggle Icons */
	.pill {
		display: inline-flex; align-items: center; justify-content: center;
		gap: 6px; padding: 6px 10px;
		border: 1px solid var(--border); border-radius: 999px;
		background: transparent; cursor: pointer; color: var(--text);
		font-size: 0.92em; text-decoration: none;
	}
	.pill:hover { border-color: var(--link-hover); color: var(--text); }
	
	/* ‚úÖ TOGGLE THEME COLORS */
	/* Sol: Amarillo natural */
	.sun { font-size: 14px; filter: none; line-height: 1; } 
	/* Luna: Blanco brillante (filtro para asegurar blancura) */
	.moon { font-size: 14px; filter: grayscale(1) brightness(10); line-height: 1; }

	html[data-theme="dark"] .sun { display: none; }
	html:not([data-theme="dark"]) .moon { display: none; }

	a, a:visited { color: var(--link); text-decoration: none; }
	a:hover { color: var(--link-hover); text-decoration: underline; }

	.side-footer {
		margin-top: 16px; padding-top: 12px;
		border-top: 1px solid var(--border);
		font-size: 0.9em; text-align: center; width: 100%;
	}

	h1 { font-size: 34px; letter-spacing: -0.02em; margin: 0.2em 0 0.4em; }
	h2 { font-size: 24px; letter-spacing: -0.01em; margin: 1.2em 0 0.4em; }
	p { margin: 0.4em 0 1em; }

	code {
		font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Cascadia Code", monospace;
		font-size: 0.95em; padding: 0.15em 0.35em;
		background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px;
	}
	pre {
		font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Cascadia Code", monospace;
		background: var(--code-bg); border: 1px solid var(--border);
		border-radius: 14px; padding: 14px 16px; overflow-x: auto;
	}
	pre code { background: none; border: none; padding: 0; }

	@media (max-width: 900px) {
		.topbar-inner { flex-direction: column; align-items: flex-start; }
		.shell { grid-template-columns: 1fr; }
		.sidebar { position: static; }
		.avatar { width: 150px; }
	}

	/* üî• TRANSICIONES SUAVES (Fix final) üî• */
	::view-transition-group(root) {
		animation-duration: 0.6s;
		animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
	}

	::view-transition-old(root) {
		animation: 0.6s cubic-bezier(0.4, 0, 0.2, 1) both fade-out;
	}
	
	::view-transition-new(root) {
		animation: 0.6s cubic-bezier(0.4, 0, 0.2, 1) both fade-in;
	}
</style>