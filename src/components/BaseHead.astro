---
interface Props {
  title: string;
  description: string;
  lang: string;
}

const { title, description, lang } = Astro.props;
const ogImage = new URL('/img/og-image.jpg', Astro.url);
---

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<meta name="generator" content={Astro.generator} />

<!-- ✅ Orden correcto -->
<meta name="color-scheme" content="light dark" />

<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />

<meta property="og:type" content="website" />
<meta property="og:url" content={Astro.url} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImage} />

<!-- ✅ Theme-color dinámico (iOS address bar) -->
<meta name="theme-color" content="#ffffff" data-dynamic-theme-color />

<!-- ✅ Tema: aplica lo antes posible -->
<script is:inline>
  (() => {
    const root = document.documentElement;

    const setThemeColor = (theme) => {
      const meta = document.querySelector('meta[data-dynamic-theme-color]');
      if (!meta) return;
      meta.setAttribute('content', theme === 'dark' ? '#232323' : '#ffffff');
    };

    const applyTheme = () => {
      let saved = null;
      try { saved = localStorage.getItem("theme"); } catch (_) {}

      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      const next = (saved === "dark" || (!saved && prefersDark)) ? "dark" : "light";

      if (root.getAttribute("data-theme") !== next) {
        root.setAttribute("data-theme", next);
      }
      setThemeColor(next);
    };

    // 1) inmediato (primer frame)
    applyTheme();

    // 2) si hay swaps en browsers no-iOS
    document.addEventListener('astro:after-swap', applyTheme);
  })();
</script>

<style>
  /* ✅ NO forzar blanco: deja que el CSS global mande */
  html { background: transparent; }

  /* ✅ primer frame oscuro si el sistema es dark */
  @media (prefers-color-scheme: dark) {
    html { background-color: #232323; }
  }

  /* ✅ si ya hay data-theme, manda eso */
  html[data-theme="dark"] { background-color: #232323; }
  html[data-theme="light"] { background-color: #ffffff; }
</style>
